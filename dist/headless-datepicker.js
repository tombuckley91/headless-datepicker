"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react"),H=require("react/jsx-runtime"),x=require("@floating-ui/react-dom"),g=require("date-fns");function L(e,r){if(e in r){const t=r[e];return typeof t=="function"?t(e):t}throw new Error("Invalid match value")}function T(e,r){return(e%r+r)%r}const J=(e,{type:r,payload:t})=>{switch(r){case"action":return N(e,t);case"registerPicker":return{...e,pickers:{...e.pickers,[t.id]:{nestedLevel:t.nestedLevel,defaultType:t.defaultType,type:t.defaultType,attach:void 0,isOpen:t.defaultOpen,alwaysOpen:t.alwaysOpen}}};case"unregisterPicker":{const{[t]:n,...o}=e.pickers;return{...e,pickers:o}}case"select":{const n=t.action?N(e,{action:t.action,pickerId:t.pickerId}):{...e};let o=null;switch(t.item.type){case"day":{o=new Date(t.item.value),o.setHours(e.hour,e.minute);break}case"month":{n.month=t.item.value;break}case"year":{n.year=t.item.value;break}case"hour":{o=e.valueRef.current?new Date(e.valueRef.current):new Date,o.setHours(t.item.value),n.hour=t.item.value;break}case"minute":{o=e.valueRef.current?new Date(e.valueRef.current):new Date,o.setMinutes(t.item.value),n.minute=t.item.value;break}default:return e}return o&&n.onChange(o),n}case"defaultChanged":return{...e,...t};case"externalValueChanged":{const n=e.config.toDateParts(t);return{...e,year:n.year,month:n.month,hour:t.getHours(),minute:t.getMinutes()}}default:throw new Error("Invalid action "+r)}};function N(e,r){let t=r.action,n="";const o=r.action.match(/^(open|close|next|prev|showYear|showMonth|showDay|toggleYear|toggleMonth|toggleDay|toggle)(.*)$/);if(o&&(t=o[1],n=o[2],n===""&&(n=r.pickerId||Object.keys(e.pickers).reverse()[0],n===void 0)))throw new Error("There is no Picker in the current Provider");switch(t){case"open":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],attach:r.ref,isOpen:!0}}};case"close":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],isOpen:!1,type:e.pickers[n].defaultType}}};case"toggle":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],attach:r.ref,isOpen:!e.pickers[n].isOpen,type:e.pickers[n].defaultType}}};case"next":{if(!e.pickers[n].type)return e;const{month:i,year:s}=e;return L(e.pickers[n].type,{hour:()=>e,minute:()=>e,day:()=>({...e,year:i===12?s+1:s,month:i%12+1}),month:()=>({...e,year:s+1,month:i}),year:()=>({...e,year:s+1,month:i})})}case"prev":{if(!e.pickers[n].type)return e;const{month:i,year:s}=e;return L(e.pickers[n].type,{hour:()=>e,minute:()=>e,day:()=>({...e,year:i===1?s-1:s,month:T(i-2,12)+1}),month:()=>({...e,year:s-1,month:i}),year:()=>({...e,year:s-1,month:i})})}case"showYear":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],type:"year"}}};case"toggleYear":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],type:e.pickers[n].type==="year"?e.pickers[n].defaultType:"year"}}};case"showMonth":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],type:"month"}}};case"toggleMonth":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],type:e.pickers[n].type==="month"?e.pickers[n].defaultType:"month"}}};case"showDay":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],type:"day"}}};case"toggleDay":return{...e,pickers:{...e.pickers,[n]:{...e.pickers[n],type:e.pickers[n].type==="day"?e.pickers[n].defaultType:"day"}}};case"today":{const i=new Date;i.setHours(e.hour,e.minute),e.onChange(i);const s=e.config.toDateParts(i);return{...e,year:s.year,month:s.month}}case"todayHour":{const i=new Date;e.onChange(i);const s=e.config.toDateParts(i);return{...e,year:s.year,month:s.month}}default:throw new Error("Invalid action "+r.action)}}const q=c.createContext(null);function W(){const e=c.useContext(q);if(!e)throw new Error("You need to use component inside Datepicker");return e}function A(){const e=W();return{...e,slot:_(e.state)}}function _(e){return{pickers:e.pickers,disabled:e.disabled,value:e.valueRef.current,month:e.month,monthName:e.config.monthNames[e.month-1],year:e.year,hour:e.hour,minute:e.minute}}const R=(e,r)=>{c.useEffect(()=>{r&&(typeof r=="function"?r(e.current):r.current=e.current)})};function S(...e){return e.filter(Boolean).join(" ")}function E(e,r,t={},n,o,i={}){if((i==null?void 0:i.visible)===!1&&i.hideOnClose!==!0)return null;const{as:s,children:a,...u}=j(r,e),f=s||n,y=typeof a=="function"?a(t):a;if(typeof u.className=="function"&&(u.className=u.className(t)),f===c.Fragment&&Object.keys(u).length>0){if(!c.isValidElement(y)||Array.isArray(y)&&y.length>1)throw new Error(['Passing props on "Fragment"!',"",'The current component is rendering a "Fragment".',"However we need to passthrough the following props:",Object.keys(u).map(m=>`  - ${m}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(m=>`  - ${m}`).join(`
`)].join(`
`));const{childClassName:d,...h}=y.props,l=typeof d=="function"?(...m)=>S(d(...m),u.className):S(d,u.className),v=l?{className:l,ref:o}:{ref:o};return c.cloneElement(y,Object.assign({},j(h,u),v))}return c.createElement(f,{...u,ref:o},y)}function j(...e){if(e.length===0)return{};if(e.length===1)return e[0];const r={},t={};for(const n of e)for(const o in n)o.startsWith("on")&&typeof n[o]=="function"?(t[o]??(t[o]=[]),t[o].push(n[o])):r[o]=n[o];if(r.disabled||r["aria-disabled"])return Object.assign(r,Object.fromEntries(Object.keys(t).map(n=>[n,void 0])));for(const n in t)Object.assign(r,{[n](o,...i){const s=t[n];for(const a of s){if((o instanceof Event||(o==null?void 0:o.nativeEvent)instanceof Event)&&o.defaultPrevented)return;a(o,...i)}}});return r}function P(e){return c.forwardRef(e)}const $=typeof window<"u"?c.useLayoutEffect:c.useEffect;function K(e,r,t,n){const o=c.useRef(r);$(()=>{o.current=r},[r]),c.useEffect(()=>{const i=(t==null?void 0:t.current)??window;if(!(i&&i.addEventListener))return;const s=u=>o.current(u),a=document.getElementById("shadow-host");return document.addEventListener.bind(a.shadowRoot)(e,s,n),()=>{document.removeEventListener.bind(a.shadowRoot)(e,s,n)}},[e,t,n])}function z(e,r){K("mousedown",t=>{(Array.isArray(e)?e:[e]).some(n=>{if(n===void 0)return!1;const o=n==null?void 0:n.current;if(!o||o.contains(t.target))return!0})||r(t)})}const Q="div",X=[x.offset(10),x.flip({fallbackAxisSideDirection:"end",crossAxis:!1}),x.shift()],C=c.createContext({nestedLevel:0}),Z=P(({alwaysOpen:e,hideOnClose:r,middleware:t=X,attachTo:n,style:o,defaultType:i,defaultOpen:s=!1,disableClickOutside:a=!1,id:u,...f},y)=>{const{nestedLevel:d}=c.useContext(C),h=c.useId(),l=u||h,{state:v,slot:m,dispatch:w}=A(),D=c.useRef(i),F=c.useRef(s);c.useEffect(()=>(w({type:"registerPicker",payload:{id:l,nestedLevel:d+1,defaultType:D.current,defaultOpen:F.current,alwaysOpen:e}}),()=>w({type:"unregisterPicker",payload:l})),[w,l,d,e]);const p=v.pickers[l],k=n===!1?void 0:n!==void 0?n:e||p==null?void 0:p.attach,I=e||(p==null?void 0:p.isOpen)||!1,{refs:M,floatingStyles:U}=x.useFloating({open:I,elements:{reference:k?k.current:null},middleware:t,whileElementsMounted:x.autoUpdate});R(M.floating,y);const G=()=>{a!==!0&&(p!=null&&p.isOpen)&&w({type:"action",payload:{action:`close${l}`}})};z([M.floating,k],G);const B={style:{...o,...k!=null&&k.current?U:{}}};return H.jsx(C.Provider,{value:c.useMemo(()=>({nestedLevel:d+1,id:l,defaultType:D.current}),[d,l]),children:E(B,f,m,Q,M.setFloating,{visible:I,hideOnClose:r})})}),ee="button",ne=P(({action:e,...r},t)=>{const{id:n}=c.useContext(C),o=c.useRef(null);R(o,t);const{slot:i,dispatch:s}=A();return E({onClick:()=>s({type:"action",payload:{action:e,ref:o,pickerId:n}})},r,i,ee,o)});function V(){const[e]=c.useState(te);return c.useEffect(()=>()=>e.dispose(),[e]),e}function te(){const e=[],r={addEventListener(t,n,o,i){return t.addEventListener(n,o,i),r.add(()=>t.removeEventListener(n,o,i))},requestAnimationFrame(...t){const n=requestAnimationFrame(...t);return r.add(()=>cancelAnimationFrame(n))},nextFrame(...t){return r.requestAnimationFrame(()=>r.requestAnimationFrame(...t))},add(t){return e.push(t),()=>{const n=e.indexOf(t);if(n>=0)for(const o of e.splice(n,1))o()}},dispose(){for(const t of e.splice(0))t()}};return r}const O=function(r){const t=c.useRef(r);return $(()=>{t.current=r},[r]),c.useCallback((...n)=>t.current(...n),[t])},re="input",oe=P(({format:e="yyyy/MM/dd",parse:r,type:t,...n},o)=>{const i=c.useRef(null);R(i,o);const{state:s,slot:a,dispatch:u}=A(),f=c.useCallback(p=>typeof e=="function"?e(p):s.config.format(p,e),[e,s.config]),[y,d]=c.useState(void 0),h=c.useMemo(()=>f(a.value),[a.value,f]),l=V(),v=O(()=>l.nextFrame(()=>u({type:"action",payload:{action:"open",ref:i}}))),m=O(p=>d(p.target.value)),w=O(p=>{let k=null;if(p.target.value)try{k=typeof e=="function"?r(p.target.value,a.value):s.config.parse(p.target.value,e,a.value)}catch{}k!==null&&g.isValid(k)&&s.onChange(k),l.nextFrame(()=>d(void 0))}),D=typeof e=="function"&&typeof r!="function",F={type:t||"text",readOnly:D,disabled:s.disabled,value:y!==void 0?y:h,onFocus:v,onChange:D?void 0:m,onBlur:D?void 0:w};return E(F,n,a,re,i)}),se="button",Y="data-calendar-item-id",ie=P(({item:e,action:r,...t},n)=>{const{id:o}=c.useContext(C),{state:i,slot:s,dispatch:a}=A(),u={[Y]:e.type+"-"+e.text,onClick:"isHeader"in e&&e.isHeader||i.disabled?void 0:()=>{a({type:"select",payload:{item:e,pickerId:o,action:r}})}};return E(u,t,s,se,n)});function ce(e,r,t){c.useLayoutEffect(()=>{if(e&&t&&r){const n=document.querySelector(`[${Y}="${r}-${t}"]`);n&&n.scrollIntoView({block:"nearest"})}},[r,t,e])}const ue="div",ae=P(({type:e,disableAutoScroll:r,...t},n)=>{const{id:o,defaultType:i}=c.useContext(C),{state:s}=A(),a=o?s.pickers[o]:void 0,u=e||(a==null?void 0:a.type)||i;if(u===void 0)throw new Error("No type provided, You need either need set the type to Items or set the defaultType to Picker component");const f=s.valueRef.current,y=c.useMemo(()=>u==="hour"||u==="minute"?s.config[u+"s"]({type:u,hour:s.hour,minute:s.minute}):s.config[u+"s"]({type:u,year:s.year,month:s.month,value:f,startOfWeek:s.startOfWeek}),[u,f,s.config,s.month,s.year,s.hour,s.minute,s.startOfWeek]);return ce(r!==!0&&a!==void 0&&(a.alwaysOpen===!0||a.isOpen)&&["year","hour","minute"].includes(u),u,u!=="day"?s[u]:void 0),E({},t,{items:y,type:u,...s},ue,n)}),b={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],format:(e,r)=>e?g.format(e,r):"",parse:(e,r,t)=>g.parse(e,r,t||new Date),toDateParts:e=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"numeric",day:"numeric"}).formatToParts(e).reduce((r,t)=>(t.type!=="literal"&&(r[t.type]=+t.value),r),{}),years:({type:e,year:r})=>{const t=new Date().getFullYear();return[...Array(200).keys()].map(n=>({type:e,key:e+n,isToday:t===n+1900,isSelected:r===n+1900,isHeader:!1,isDisabled:!1,disabled:!1,value:n+1900,text:n+1900+""}))},months:({type:e,month:r})=>{const t=new Date().getMonth();return[...b.monthNames.keys()].map(n=>({type:e,key:e+n,isToday:t===n,isSelected:r===n+1,isHeader:!1,isDisabled:!1,disabled:!1,value:n+1,text:b.monthNames[n]}))},days:({type:e,month:r,startOfWeek:t,year:n,value:o})=>{const i=new Date(n,r-1,1),s=g.startOfMonth(i),a=g.endOfMonth(i),u=T(t-1,7),f=g.startOfToday().getTime(),y=o?g.startOfDay(o).getTime():0;return b.dayNames.map((d,h)=>{const l=T(t+h,7);return{type:e,key:"weekday"+l,isToday:!1,isSelected:!1,isHeader:!0,isDisabled:!1,disabled:!1,value:h,text:b.dayNames[l]}}).concat(g.eachDayOfInterval({start:g.addDays(s,-T(s.getDay()-t,7)),end:g.addDays(a,T(u-a.getDay(),7))}).map(d=>({type:e,key:d.toString(),isToday:f===d.getTime(),isSelected:y===d.getTime(),isHeader:!1,isInCurrentMonth:d<s||d>a,isDisabled:d<s||d>a,disabled:d<s||d>a,value:d,text:d.getDate()+""})))},hours:({type:e,hour:r})=>[...Array(24).keys()].map(t=>({type:e,key:t,value:t,text:t+"",isToday:!1,isSelected:r===t,isHeader:!1,isDisabled:!1,disabled:!1})),minutes:({type:e,minute:r})=>[...Array(60).keys()].map(t=>({type:e,key:t,value:t,text:t+"",isToday:!1,isSelected:r===t,isHeader:!1,isDisabled:!1,disabled:!1}))},de=c.Fragment,le=c.forwardRef(({defaultValue:e,value:r,onChange:t,disabledKeyboardNavigation:n,disabled:o=!1,config:i=b,startOfWeek:s=0,...a},u)=>{const f=c.useRef(r||e||null),y=V(),d=O(m=>{fe(f.current,m)||y.nextFrame(()=>{f.current=m,t==null||t(f.current),l({type:"externalValueChanged",payload:m||new Date})})}),[h,l]=c.useReducer(J,null,()=>{const m=f.current||new Date,w=i.toDateParts(m);return{config:i,disabled:o,year:w.year,month:w.month,hour:m.getHours(),minute:m.getMinutes(),calendarOpen:!1,hourOpen:!1,valueRef:f,startOfWeek:s,onChange:d,pickers:{}}});c.useEffect(()=>{d(r||null)},[r,d]),c.useEffect(()=>{l({type:"defaultChanged",payload:{startOfWeek:s}})},[s]),c.useEffect(()=>{l({type:"defaultChanged",payload:{disabled:o}})},[o]);const v={};return H.jsx(q.Provider,{value:{state:h,dispatch:l},children:E(v,a,_(h),de,u)})});function fe(e,r){return e===r||e!==null&&r!==null&&g.isEqual(e,r)}const pe=Object.assign(le,{Picker:Z,Input:oe,Button:ne,Items:ae,Item:ie});exports.Datepicker=pe;exports.config=b;
